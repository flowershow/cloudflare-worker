name = "markdown-parser-worker"
main = "src/worker.js"
compatibility_date = "2024-03-18"
compatibility_flags = ["nodejs_compat"]

# Queue for processing S3 events
[[queues.producers]]
binding = "FILE_PROCESSOR_QUEUE"
queue = "markdown-file-processor-queue-dev"

[[queues.consumers]]
queue = "markdown-file-processor-queue-dev"
max_batch_size = 1
max_batch_timeout = 30
max_retries = 3

[env.production]
# Production queue configuration
[[env.production.queues.producers]]
binding = "FILE_PROCESSOR_QUEUE"
queue = "markdown-file-processor-queue"

[[env.production.queues.consumers]]
queue = "markdown-file-processor-queue"
max_batch_size = 1
max_batch_timeout = 30
max_retries = 3

[vars]
# These will be loaded from .env file during local development
S3_ACCESS_KEY_ID = ""
S3_SECRET_ACCESS_KEY = ""
S3_REGION = ""
S3_BUCKET = ""
DATABASE_URL = ""
S3_ENDPOINT = ""
S3_FORCE_PATH_STYLE = ""

# Local development settings
[dev]
port = 8787
local_protocol = "http"